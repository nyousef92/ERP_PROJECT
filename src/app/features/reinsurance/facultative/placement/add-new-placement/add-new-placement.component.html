@if (form) {
<div class="bg-surface rounded-lg w-full relative flex flex-col max-h-[90vh]">

  <div class="p-4 sm:p-6 border-b border-border flex-shrink-0">
    <div class="flex items-start justify-between gap-4">
      <div class="flex-1 min-w-0">
        <h2 class="text-text">New Placement</h2>
        <p class="text-sm text-text-muted mt-1">Fill in the details to create a new placement.</p>
      </div>
      <button (click)="onCancel()" class="text-text-muted hover:text-text-secondary transition-colors flex-shrink-0">
        <span class="material-icons text-[20px]">close</span>
      </button>
    </div>
  </div>

  <div class="p-4 sm:p-6 space-y-6 overflow-y-auto flex-1" [formGroup]="form">

    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
      <app-input-field formControlName="refNo" label="Ref No. (Manual)" placeholder="Enter Ref No." />
      <app-select-dropdown formControlName="cedant" label="Cedant" [options]="cedantList" [required]="true"
        placeholder="Select Cedant" [errorMessage]="getError('cedant', 'Cedant')"
        [touched]="form.get('cedant')?.touched" />
      <app-input-field formControlName="status" label="Status" [disabled]="true" />

    </div>

    <app-input-field formControlName="placementName" label="Placement Name" placeholder="Enter placement name" />

    <div>
      <h3 class="text-sm text-text mb-0.5">Original Policy Details</h3>
      <p class="text-xs text-text-muted mb-4">Enter the details of the original insurance policy.</p>

      <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-4">


        <app-input-field formControlName="sumInsured" [label]="`vSum Insured(${form.get('currency')?.value || 'USD'})`"
          placeholder="0.00" type="text" />

        <app-input-field formControlName="rate" label="Rate (%)" placeholder="0.00" type="text" />
        <app-select-dropdown formControlName="currency" label="Currency" [options]="currencyList"
          placeholder="Select Currency" />
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4">

        <app-input-field formControlName="grossPremium" [label]="`Gross Premium(SR)`" placeholder="0.00" type="text" />
        <app-input-field formControlName="cedingCommission" label="Ceding Commission (%)" placeholder="0.00"
          type="text" />
        <app-input-field formControlName="uibShare" label="UIB Share (%)" placeholder="0.00" type="text" />
        <app-input-field formControlName="netPremium" label="Net Premium" placeholder="0.00" type="text" />
        <app-input-field formControlName="npos" label="NPOS" placeholder="0.00" type="text" />

      </div>
    </div>

    <div>
      <div class="flex items-center justify-between mb-3">
        <div>
          <h3 class="text-sm text-text">Placement Securities</h3>
          <p class="text-xs text-text-muted mt-0.5">Manage reinsurance placement securities.</p>
        </div>
        <button type="button" (click)="addSecurity()"
          class="px-3 py-1.5 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors flex items-center gap-2 text-sm">
          <span class="material-icons text-[16px]">add</span>
          Add Security
        </button>
      </div>

      <div class="overflow-x-auto border border-border rounded-lg">
        <table class="w-full">
          <thead class="bg-background border-b border-border">
            <tr>
              <th class="px-3 py-2 text-left text-xs text-text-muted">SECURITY</th>
              <th class="px-3 py-2 text-left text-xs text-text-muted">SHARE (%)</th>
              <th class="px-3 py-2 text-left text-xs text-text-muted">RI RATE (%)</th>
              <th class="px-3 py-2 text-left text-xs text-text-muted">RI PREMIUM</th>
              <th class="px-3 py-2 text-left text-xs text-text-muted">RI COMM (%)</th>
              <th class="px-3 py-2 text-left text-xs text-text-muted">RI TAX (%)</th>
              <th class="px-3 py-2 text-left text-xs text-text-muted">NET RI PREMIUM</th>
              <th class="px-3 py-2"></th>
            </tr>
          </thead>
          <tbody class="divide-y divide-border">
            @for (row of securities; track $index) {
            <tr class="hover:bg-background transition-colors">
              <td class="px-3 py-2">
                <select [(ngModel)]="row.security" [ngModelOptions]="{standalone: true}"
                  class="w-full px-2 py-1.5 text-sm text-text bg-surface border border-border rounded focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary">
                  <option value="">Select Reinsurer</option>
                  @for (r of reinsurerList; track r.id) {
                  <option [value]="r.value">{{ r.label }}</option>
                  }
                </select>
              </td>
              <td class="px-3 py-2">
                <input [(ngModel)]="row.share" [ngModelOptions]="{standalone: true}" type="text" placeholder="0.00"
                  class="w-24 px-2 py-1.5 text-sm text-text bg-surface border border-border rounded focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary placeholder:text-text-muted" />
              </td>
              <td class="px-3 py-2">
                <input [(ngModel)]="row.riRate" [ngModelOptions]="{standalone: true}" type="text" placeholder="0.00"
                  class="w-24 px-2 py-1.5 text-sm text-text bg-surface border border-border rounded focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary placeholder:text-text-muted" />
              </td>
              <td class="px-3 py-2">
                <input [(ngModel)]="row.riPremium" [ngModelOptions]="{standalone: true}" type="text" placeholder="0.00"
                  class="w-28 px-2 py-1.5 text-sm text-text bg-surface border border-border rounded focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary placeholder:text-text-muted" />
              </td>
              <td class="px-3 py-2">
                <input [(ngModel)]="row.riComm" [ngModelOptions]="{standalone: true}" type="text" placeholder="0.00"
                  class="w-28 px-2 py-1.5 text-sm text-text bg-surface border border-border rounded focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary placeholder:text-text-muted" />
              </td>
              <td class="px-3 py-2">
                <input [(ngModel)]="row.riTax" [ngModelOptions]="{standalone: true}" type="text" placeholder="0.00"
                  class="w-28 px-2 py-1.5 text-sm text-text bg-surface border border-border rounded focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary placeholder:text-text-muted" />
              </td>
              <td class="px-3 py-2">
                <input [(ngModel)]="row.netRiPremium" [ngModelOptions]="{standalone: true}" type="text"
                  placeholder="0.00"
                  class="w-28 px-2 py-1.5 text-sm text-text bg-surface border border-border rounded focus:outline-none focus:border-primary focus:ring-1 focus:ring-primary placeholder:text-text-muted" />
              </td>
              <td class="px-3 py-2">
                <button type="button" (click)="removeSecurity($index)"
                  class="p-1 hover:bg-danger-light rounded transition-colors">
                  <span class="material-icons text-[14px] text-danger">delete</span>
                </button>
              </td>
            </tr>
            } @empty {
            <tr>
              <td colspan="8" class="px-3 py-6 text-center text-sm text-text-muted">
                No securities added yet.
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>
    </div>

  </div>

  <div
    class="px-4 sm:px-6 py-4 border-t border-border flex flex-col sm:flex-row items-stretch sm:items-center justify-end gap-3 flex-shrink-0">
    <button type="button" (click)="onCancel()"
      class="px-4 py-2 border border-border rounded-lg text-sm text-text-secondary hover:bg-background transition-colors">
      Cancel
    </button>
    <button type="button" (click)="onSave()"
      class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors flex items-center justify-center gap-2 text-sm">
      Save
    </button>
  </div>

</div>
}
<div class="bg-surface rounded-lg w-full flex flex-col" *ngIf="treaty; else loading">

    <!-- Header -->
    <div class="sticky top-0 bg-surface border-b border-border px-4 py-3 flex items-center justify-between z-10">
        <h2 class="text-sm font-semibold text-text">Treaty Review &amp; Approval</h2>
    </div>

    <!-- Scrollable Body -->
    <div class="flex-1 overflow-y-auto p-4">
        <div class="space-y-5">

            <!-- Company Information -->
            <div class="space-y-2">
                <h3
                    class="text-[10px] font-semibold uppercase tracking-wide text-text-muted pb-1 border-b border-border">
                    Company Information
                </h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
                    <div>
                        <label class="block text-xs text-text-muted mb-1">Company</label>
                        <input type="text" readonly
                            class="w-full px-3 py-1.5 text-xs border border-border rounded-lg bg-background text-text"
                            [value]="treaty.companyInformation.company">
                    </div>
                    <div>
                        <label class="block text-xs text-text-muted mb-1">Company ID</label>
                        <input type="text" readonly
                            class="w-full px-3 py-1.5 text-xs border border-border rounded-lg bg-background text-text"
                            [value]="treaty.companyInformation.companyId">
                    </div>
                    <div>
                        <label class="block text-xs text-text-muted mb-1">Account No</label>
                        <input type="text" readonly
                            class="w-full px-3 py-1.5 text-xs border border-border rounded-lg bg-background text-text"
                            [value]="treaty.companyInformation.accountNo">
                    </div>
                    <div>
                        <label class="block text-xs text-text-muted mb-1">Phone No</label>
                        <input type="text" readonly
                            class="w-full px-3 py-1.5 text-xs border border-border rounded-lg bg-background text-text"
                            [value]="treaty.companyInformation.phoneNo">
                    </div>
                    <div>
                        <label class="block text-xs text-text-muted mb-1">Fax</label>
                        <input type="text" readonly
                            class="w-full px-3 py-1.5 text-xs border border-border rounded-lg bg-background text-text"
                            [value]="treaty.companyInformation.fax">
                    </div>
                    <div>
                        <label class="block text-xs text-text-muted mb-1">Email</label>
                        <input type="text" readonly
                            class="w-full px-3 py-1.5 text-xs border border-border rounded-lg bg-background text-text"
                            [value]="treaty.companyInformation.email">
                    </div>
                </div>
                <div>
                    <label class="block text-xs text-text-muted mb-1">Address</label>
                    <input type="text" readonly
                        class="w-full px-3 py-1.5 text-xs border border-border rounded-lg bg-background text-text"
                        [value]="treaty.companyInformation.address">
                </div>
            </div>

            <!-- Treaty Details -->
            <div class="space-y-2">
                <h3
                    class="text-[10px] font-semibold uppercase tracking-wide text-text-muted pb-1 border-b border-border">
                    Treaty Details
                </h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
                    <div>
                        <label class="block text-xs text-text-muted mb-1">Treaty Code</label>
                        <input type="text" readonly
                            class="w-full h-[34px] px-2.5 py-1.5 text-sm border border-border rounded-lg bg-blue-50 text-blue-700 dark:bg-blue-900/20 dark:text-blue-400"
                            [value]="treaty.treatyDetails.treatyCode">
                    </div>
                    <div>
                        <label class="block text-xs text-text-muted mb-1">Description</label>
                        <input type="text" readonly
                            class="w-full h-[34px] px-2.5 py-1.5 text-sm border border-border rounded-lg bg-background text-text"
                            [value]="treaty.treatyDetails.description">
                    </div>
                    <div>
                        <label class="block text-xs text-text-muted mb-1">Treaty Type</label>
                        <input type="text" readonly
                            class="w-full h-[34px] px-2.5 py-1.5 text-sm border border-border rounded-lg bg-background text-text"
                            [value]="treaty.treatyDetails.treatyType">
                    </div>
                    <div>
                        <label class="block text-xs text-text-muted mb-1">Treaty Sub Type</label>
                        <input type="text" readonly
                            class="w-full h-[34px] px-2.5 py-1.5 text-sm border border-border rounded-lg bg-background text-text"
                            [value]="treaty.treatyDetails.treatySubType">
                    </div>
                    <div>
                        <label class="block text-xs text-text-muted mb-1">Currency</label>
                        <input type="text" readonly
                            class="w-full h-[34px] px-2.5 py-1.5 text-sm border border-border rounded-lg bg-background text-text"
                            [value]="treaty.treatyDetails.currency">
                    </div>
                    <div>
                        <label class="block text-xs text-text-muted mb-1">From Date</label>
                        <input type="text" readonly
                            class="w-full h-[34px] px-2.5 py-1.5 text-sm border border-border rounded-lg bg-background text-text"
                            [value]="treaty.treatyDetails.fromDate">
                    </div>
                    <div>
                        <label class="block text-xs text-text-muted mb-1">To Date</label>
                        <input type="text" readonly
                            class="w-full h-[34px] px-2.5 py-1.5 text-sm border border-border rounded-lg bg-background text-text"
                            [value]="treaty.treatyDetails.toDate">
                    </div>
                    <div>
                        <label class="block text-xs text-text-muted mb-1">LOB</label>
                        <input type="text" readonly
                            class="w-full h-[34px] px-2.5 py-1.5 text-sm border border-border rounded-lg bg-background text-text"
                            [value]="treaty.treatyDetails.lob">
                    </div>
                    <div>
                        <label class="block text-xs text-text-muted mb-1">Sub LOB</label>
                        <input type="text" readonly
                            class="w-full h-[34px] px-2.5 py-1.5 text-sm border border-border rounded-lg bg-background text-text"
                            [value]="treaty.treatyDetails.subLob">
                    </div>
                </div>
                <div>
                    <label class="block text-xs text-text-muted mb-1">Comments</label>
                    <input type="text" readonly
                        class="w-full h-[34px] px-2.5 py-1.5 text-sm border border-border rounded-lg bg-background text-text"
                        [value]="treaty.treatyDetails.comments">
                </div>
                <div class="flex items-center gap-2 h-[34px]">
                    <input type="checkbox" id="catastropheCoverage" [checked]="treaty.treatyDetails.catastropheCoverage"
                        disabled class="w-4 h-4 text-primary border-border rounded">
                    <label for="catastropheCoverage" class="text-sm text-text">Catastrophe Coverage</label>
                </div>
            </div>

            <!-- Reinsurer Participation -->
            <div class="space-y-2">
                <h3
                    class="text-[10px] font-semibold uppercase tracking-wide text-text-muted pb-1 border-b border-border">
                    Reinsurer Participation
                </h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-xs border-collapse">
                        <thead>
                            <tr class="bg-orange-500 text-white">
                                <th class="px-2 py-2 text-left border border-gray-300 min-w-[140px]">Company</th>
                                <th class="px-2 py-2 text-left border border-gray-300 min-w-[100px]">Capacity</th>
                                <th class="px-2 py-2 text-left border border-gray-300 min-w-[70px]">QS%</th>
                                <th class="px-2 py-2 text-left border border-gray-300 min-w-[90px]">Retention%</th>
                                <th class="px-2 py-2 text-left border border-gray-300 min-w-[80px]">Signed%</th>
                                <th class="px-2 py-2 text-left border border-gray-300 min-w-[80px]">Written%</th>
                                <th class="px-2 py-2 text-left border border-gray-300 min-w-[70px]">Broker%</th>
                                <th class="px-2 py-2 text-left border border-gray-300 min-w-[60px]">Tax%</th>
                                <th class="px-2 py-2 text-left border border-gray-300 min-w-[60px]">Comm%</th>
                                <th class="px-2 py-2 text-left border border-gray-300 min-w-[120px]">Reason</th>
                                <th class="px-2 py-2 text-left border border-gray-300 min-w-[120px]">Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            @for (r of treaty.reinsurerParticipation; track r.company) {
                            <tr class="border-b border-border hover:bg-background transition-colors">
                                <td class="px-2 py-1.5 border border-border text-text">{{ r.company }}</td>
                                <td class="px-2 py-1.5 border border-border text-text">{{ r.capacity | number }}</td>
                                <td class="px-2 py-1.5 border border-border text-text">{{ r.qsPercent }}</td>
                                <td class="px-2 py-1.5 border border-border text-text">{{ r.retentionPercent }}</td>
                                <td class="px-2 py-1.5 border border-border text-text">{{ r.signedPercent }}</td>
                                <td class="px-2 py-1.5 border border-border text-text">{{ r.writtenPercent }}</td>
                                <td class="px-2 py-1.5 border border-border text-text">{{ r.brokerPercent }}</td>
                                <td class="px-2 py-1.5 border border-border text-text">{{ r.taxPercent }}</td>
                                <td class="px-2 py-1.5 border border-border text-text">{{ r.commissionPercent }}</td>
                                <td class="px-2 py-1.5 border border-border text-text">{{ r.reason }}</td>
                                <td class="px-2 py-1.5 border border-border text-text">{{ r.description }}</td>
                            </tr>
                            }
                            @empty {
                            <tr>
                                <td colspan="11" class="px-3 py-4 text-center text-text-muted text-xs">No reinsurer
                                    participation data.</td>
                            </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Submission Information -->
            <div class="space-y-2">
                <h3
                    class="text-[10px] font-semibold uppercase tracking-wide text-text-muted pb-1 border-b border-border">
                    Submission Information
                </h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <div>
                        <label class="block text-xs text-text-muted mb-1">Submitted By</label>
                        <input type="text" readonly
                            class="w-full h-[34px] px-2.5 py-1.5 text-sm border border-border rounded-lg bg-background text-text"
                            [value]="treaty.submissionInformation.submittedBy">
                    </div>
                    <div>
                        <label class="block text-xs text-text-muted mb-1">Submitted Date</label>
                        <input type="text" readonly
                            class="w-full h-[34px] px-2.5 py-1.5 text-sm border border-border rounded-lg bg-background text-text"
                            [value]="treaty.submissionInformation.submittedDate">
                    </div>
                </div>
            </div>

            <!-- Approval Action -->
            <div class="space-y-2">
                <h3
                    class="text-[10px] font-semibold uppercase tracking-wide text-text-muted pb-1 border-b border-border">
                    Approval Action
                </h3>
                <div>
                    <label class="block text-xs text-text-muted mb-1">Remarks *</label>
                    <textarea rows="4" [(ngModel)]="remarks"
                        class="w-full px-3 py-2 text-sm border border-border rounded-lg bg-background text-text focus:outline-none focus:ring-2 focus:ring-primary transition-colors"
                        placeholder="Enter your remarks for approval or rejection..."></textarea>
                </div>
            </div>

        </div>
    </div>

    <!-- Footer Actions -->
    <div
        class="px-4 py-3 border-t border-border flex flex-col sm:flex-row items-stretch sm:items-center justify-end gap-2 sm:gap-3 flex-shrink-0 bg-background sticky bottom-0 z-10">
        <button (click)="onClose()"
            class="px-4 py-2 border border-border rounded-lg text-text hover:bg-surface transition-colors text-sm order-last sm:order-first">
            Close
        </button>
        <button (click)="onReject()"
            class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm">
            Reject
        </button>
        <button (click)="onApprove()"
            class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm">
            Approve
        </button>
    </div>

</div>

<!-- Loading state -->
<ng-template #loading>
    <div class="p-8 text-center text-text-muted">
        <span class="material-icons text-[40px] block mb-2 animate-spin opacity-40">sync</span>
        Loading...
    </div>
</ng-template>
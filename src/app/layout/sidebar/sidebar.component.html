<div class="flex h-screen">
  <!-- Sidebar -->
  <aside
    class="bg-sidebar text-white transition-all duration-300 overflow-x-hidden overflow-y-auto fixed h-full z-50 start-0"
    [class.w-60]="isExpanded" [class.w-16]="!isExpanded">
    <!-- Header -->
    <div class="p-6 border-b border-white/10">
      @if (isExpanded) {
      <h1 class="text-lg font-semibold whitespace-nowrap">ERP System</h1>
      <p class="text-xs text-slate-400 mt-1">
        Insurance Management
      </p>
      }
    </div>

    <!-- Nav list -->
    <nav class="pt-2">
      @for (item of menuItems; track item.label) {

      <!-- Level 1 -->
      @if (item.children) {
      <div>
        <a (click)="toggleItem(item)" [title]="item.label"
          class="flex items-center px-4 py-2.5 text-white/70 hover:bg-white/[0.08] hover:text-white cursor-pointer transition-colors">
          <span class="material-icons text-[20px] mr-3">{{ item.icon }}</span>
          @if (isExpanded) {
          <span class="text-sm flex-1">{{ item.label }}</span>
          <span class="material-icons text-[18px] transition-transform duration-300"
            [class.rotate-180]="item.expanded">expand_more</span>
          }
        </a>

        <!-- Level 2 -->
        @if (item.expanded && isExpanded) {
        <div>
          @for (child of item.children; track child.label) {

          @if (child.children) {
          <div>
            <a (click)="toggleItem(child)" [title]="child.label"
              class="flex items-center pl-10 pr-4 py-2 mx-2 rounded-lg text-white/70 hover:bg-white/[0.08] hover:text-white cursor-pointer transition-colors text-sm">
              <span class="flex-1">{{ child.label }}</span>
              <span class="material-icons text-[16px] transition-transform duration-300"
                [class.rotate-180]="child.expanded">expand_more</span>
            </a>

            <!-- Level 3 -->
            @if (child.expanded) {
            <div>
              @for (grandchild of child.children; track grandchild.label) {

              @if (grandchild.children) {
              <div>
                <a (click)="toggleItem(grandchild)" [title]="grandchild.label"
                  class="flex items-center pl-16 pr-4 py-2 mx-2 rounded-lg text-white/70 hover:bg-white/[0.08] hover:text-white cursor-pointer transition-colors text-[13px]">
                  <span class="flex-1">{{ grandchild.label }}</span>
                  <span class="material-icons text-[14px] transition-transform duration-300"
                    [class.rotate-180]="grandchild.expanded">expand_more</span>
                </a>

                <!-- Level 4 -->
                @if (grandchild.expanded) {
                <div>
                  @for (great of grandchild.children; track great.label) {
                  <a [routerLink]="great.route" routerLinkActive="!bg-primary !text-white" [title]="great.label"
                    class="flex items-center pl-20 pr-4 py-1.5 mx-2 rounded-lg text-white/50 hover:bg-white/[0.08] hover:text-white cursor-pointer transition-colors text-[12px]">
                    <span class="w-0.5 h-0.5 rounded-full bg-white/20 mr-3 shrink-0"></span>
                    <span>{{ great.label }}</span>
                  </a>
                  }
                </div>
                }

              </div>
              } @else {
              <a [routerLink]="grandchild.route" routerLinkActive="!bg-primary !text-white" [title]="grandchild.label"
                class="flex items-center pl-16 pr-4 py-2 mx-2 rounded-lg text-white/70 hover:bg-white/[0.08] hover:text-white cursor-pointer transition-colors text-[13px]">
                <span>{{ grandchild.label }}</span>
              </a>
              }

              }
            </div>
            }
          </div>

          } @else {
          <a [routerLink]="child.route" routerLinkActive="!bg-primary !text-white" [title]="child.label"
            class="flex items-center pl-10 pr-4 py-2 mx-2 rounded-lg text-white/70 hover:bg-white/[0.08] hover:text-white cursor-pointer transition-colors text-sm">
            <span>{{ child.label }}</span>
          </a>
          }

          }
        </div>
        }
      </div>

      } @else {
      <!-- Level 1: Leaf -->
      <a [routerLink]="item.route" routerLinkActive="!bg-primary !text-white" [title]="item.label"
        class="flex items-center px-4 py-2.5 mx-2 rounded-lg text-white/70 hover:bg-white/[0.08] hover:text-white cursor-pointer transition-colors">
        <span class="material-icons text-[20px] mr-3">{{ item.icon }}</span>
        @if (isExpanded) {
        <span class="text-sm">{{ item.label }}</span>
        }
      </a>
      }

      }
    </nav>
  </aside>

  <!-- Main content -->
  <div [style.width]="isExpanded ? 'calc(100% - 15rem)' : 'calc(100% - 4rem)'"
    class="flex-1 flex flex-col transition-all duration-300" [class.ms-60]="isExpanded" [class.ms-16]="!isExpanded">
    <app-header (menuToggle)="toggleSidenav()" [isExpanded]="isExpanded" />
    <main class="flex-1 p-6 bg-background overflow-x-hidden ">
      <ng-content></ng-content>
    </main>
  </div>
</div>